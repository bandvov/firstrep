let express=require("express"),app=express(),router=express.Router(),mssql=require("mssql"),port=8080,config={user:"test",password:"12345",database:"testdb",server:"localhost",port:1433,pool:{min:0,max:10,idleTimeoutMillis:3e4}},connection=new mssql.ConnectionPool(config).connect(function(err){err&&console.log(err)});app.use(function(req,res){res.header("Access-Control-Allow-Origin","*"),res.header("Access-Control-Allow-Headers","Origin,X-Reqyewsted-With, Content-Type,Accept")}),router.get("/",function(req,res){let request;new mssql.Request(connection).query("SELECT * FROM items",function(err,data){err&&console.log(err),res.status(200).send(`selected items : ${JSON.stringify(data.recordset)}`)})}),router.get("/:id",function(req,res){let ps=new mssql.PreparedStatement(connection),inserts={id:parseInt(req.params.id)};ps.input("id",mssql.Int),ps.prepare("SELECT * FROM items WHERE id=@id",function(err){err&&console.log(err),ps.execute(inserts,function(err,data){err&&console.log(err),console.log("url",req.url),res.status(200).send(`selected items with ID : ${JSON.stringify(data.recordsets)}`),ps.unprepare()})})}),router.post("/",function(req,res){let request;new mssql.Request(connection).query("INSERT INTO items (name,description,completed) VALUES (@name,@description,@completed)",function(err,data){err&&console.log(err),console.log(`url: ${req.url}`),res.status(200).send("sample item added to database")})}),router.put("/:id",function(req,res){let ps=new mssql.PreparedStatement(connection),inserts={id:parseInt(req.params.id)};ps.input("id",mssql.Int),ps.prepare('UPDATE items SET name="new Name",description="some other text",completed=0 ',function(err){err&&console.log(err),console.log(`url ${req.url}`),ps.execute(inserts,function(err){err&&console.log(err),console.log(`PUT ${req.url}`),res.status(200).send(`item by ID : ${req.params.id} changed!`),ps.unprepare()})})}),router.delete("/",function(req,res){let ps=new mssql.PreparedStatement(connection),inserts={id:req.params.id};ps.input("id",mssql.Int),ps.prepare("DELETE * FROM items WHERE id=@id",function(err){err&&console.log(err),ps.execute(inserts,function(err,data){err&&console.log(err),res.status(200).send(`item with ID : ${req.params.id} deleted!`),ps.unprepare()})})}),app.use("/api",router.route),app.listen(port,function(){console.log("listen...",port)});